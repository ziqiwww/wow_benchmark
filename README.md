# [SIGMOD '26] WoW: A Window-to-Window Incremental Index for Range-Filtering Approximate Nearest Neighbor Search [The benchmarking repository].

> This is the benchmarking repository of WoW. For the header-only library and its python bindings, please check [here](https://github.com/nju-websoft/WoW).

## Requirements
- A modern C++ compiler that supports C++20
- CMake 3.20 or higher
- OpenMP
- Dependencies: [fmt](https://github.com/fmtlib/fmt), [argparse](https://github.com/p-ranav/argparse), [hnswlib](https://github.com/nmslib/hnswlib), [ygg](https://github.com/tinloaf/ygg).

## Installation
1. Clone the repository with submodules:
```bash
git clone --recursive https://github.com/ziqiwww/wow_benchmark
```
2. Build the project:
```bash
mkdir build && cd build
cmake .. && make -j
```
3. Executables:
- `build/bin/buildspatt`: build WoW by ordered insertion, WoW (ordered).
- `build/bin/searchspatt`: search the top-k nearest neighbors with range filter, using WoW (ordered) generated by `build/bin/buildspatt`.
- `build/bin/buildspattplus`: build WoW with full capabilities and optimizations, supporting unordered insertion.
- `build/bin/searchspattplus`: search the top-k nearest neighbors with range filter, using WoW generated by `build/bin/buildspattplus`.

## Datasets
We provide the urls of the vector datasets used in the paper:
- [SIFT1M](http://corpus-texmex.irisa.fr/): SIFT1M dataset, the synthetic attribute is generated by the authors.
- [GIST1M](http://corpus-texmex.irisa.fr/): GIST1M dataset, the synthetic attribute is generated by the authors.
- [ArXiv](https://github.com/qdrant/ann-filtering-benchmark-datasets): a recent hybrid dataset released by QDrant.
It involves vectors embedded from over two million paper titles using the all-MiniLM-L6 encoder, along with release time as the attribute.
- [Wikidata](https://huggingface.co/datasets/Cohere/wikipedia-2023-11-embed-multilingual-v3): a multilingual dataset released by Cohere, and the English version subset is used.
Two sizes of the dataset are used in the paper: 4M and 41M (complete dataset).
The attribute is the entity title, ranked by the dictionary order.
- [Deep](https://research.yandex.com/blog/benchmarks-for-billion-scale-similarity-search): obtained from the last fully-connected layer of the GoogleNet model with image size as the attribute.
Two sizes of the dataset are used in the paper: 10M and 100M.

For more details, please refer to the paper.

- The vector file format is [.fvecs](http://corpus-texmex.irisa.fr/).
- The range filter file is a binary file consists of `nq` pairs of 4-byte integers, where the first integer is the lower bound and the second integer is the upper bound.
A python script to generate range files with different selectivity is provided in the `exp` folder. to generate range files with 10k queries for a dataset with 4M vectors, run:
    ```bash
    python gen_iranges.py --n 4000000 --q 10000 --o ./intrng10k_4000000/  
    ```
    The folder will then contain 0.bin-17.bin files, each of which contains 10k queries with different selectivity.
    17.bin is the mixed range filter file in the paper.
- The vector id is used as the attribute in the code. Therefore, the vector file should be sorted by attribute in advance.

## Benchmark
### Run our method
- We provide a bash script `exp/build_index.sh` to build the index, and `exp/search.sh` to search the top-k nearest neighbors with range filter.
- Change the parameter `is_ordered` in `exp/build_index.sh` to switch between the ordered and unordered version of WoW.
- The ordered index name begins with `layered` and the unordered index name begins with `pp`.
- For more details and how to make a quick start, please refer to the above bash files.
### Run baselines
- pre-filtering and post-filtering: run `bash exp/run_naive.sh`.
- [SeRF](https://github.com/rutgers-db/SeRF), [WST](https://github.com/JoshEngels/RangeFilteredANN), [iRangeGraph](https://github.com/YuexuanXu7/iRangeGraph), [ACORN](https://github.com/guestrin-lab/ACORN), [Milvus](https://github.com/milvus-io/milvus), [HSIG](https://github.com/sjtu-dbgroup/UNIFY): we follow the instructions in their repositories to build the indices and search.

